<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartLogistics Pro | Control Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
       .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        @keyframes pulse-green { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
       .live-indicator { animation: pulse-green 2s infinite; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">

    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight">SmartLogistics <span class="text-blue-400 font-medium">Pro</span></h1>
            </div>
            <div class="hidden md:flex items-center gap-4 text-xs font-bold uppercase tracking-wider opacity-70">
                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-emerald-500 rounded-full live-indicator"></span> PLC System Online</span>
                <span class="border-l border-slate-700 pl-4">SCADA Traceability Active</span>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-slate-700">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" /></svg>
                    Parcel Labeling Unit
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Customer Name</label>
                        <input type="text" id="cust" placeholder="e.g. John Doe" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 transition-all text-sm">
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Full Delivery Address</label>
                        <textarea id="addr" rows="2" placeholder="Street, Town Hub..." class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 transition-all text-sm resize-none"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Target Hub</label>
                            <select id="hub" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm font-semibold text-blue-600 appearance-none">
                                <option value="Zone X">Town Hub X</option>
                                <option value="Zone Y">Zone Y</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Item Price ($)</label>
                            <input type="number" id="price" placeholder="0.00" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-sm">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Weight (kg)</label>
                            <input type="number" id="weight" step="0.1" placeholder="1.0" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 ml-1">Payment Method</label>
                            <select id="pay" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm appearance-none">
                                <option value="Prepaid">Prepaid</option>
                                <option value="COD">COD</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="processDispatch()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-200 active:scale-95 transition-all mt-2">
                        Generate QR & Dispatch
                    </button>
                </div>
            </div>

            <div id="qr-result" class="hidden bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center">
                <div id="qr-container" class="bg-white p-4 border-4 border-slate-900 rounded-2xl mb-4">
                    </div>
                <p id="display-id" class="font-mono text-blue-600 font-bold text-sm mb-1"></p>
                <div class="flex gap-4">
                    <button onclick="downloadQR()" class="text-xs font-bold text-slate-500 hover:text-blue-600 underline">Download Label</button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8 space-y-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Total Items</p>
                    <p id="stat-total" class="text-2xl font-bold text-slate-800">0</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 shadow-sm text-blue-900">
                    <p class="text-[10px] font-bold opacity-60 uppercase">Town Hub X</p>
                    <p id="stat-hub-x" class="text-2xl font-bold">0</p>
                </div>
                <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 shadow-sm text-emerald-900">
                    <p class="text-[10px] font-bold opacity-60 uppercase">Success Rate</p>
                    <p class="text-2xl font-bold">100%</p>
                </div>
                <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100 shadow-sm text-amber-900">
                    <p class="text-[10px] font-bold opacity-60 uppercase">Total Value</p>
                    <p id="stat-value" class="text-2xl font-bold">$0.00</p>
                </div>
            </div>

            <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden min-h-[400px]">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                    <h3 class="font-bold text-slate-700">SCADA | Real-Time Dispatch Log</h3>
                    <span class="text-[10px] font-bold text-emerald-600 bg-emerald-100 px-2 py-1 rounded-full uppercase tracking-widest">Live</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-500 text-[10px] uppercase font-bold tracking-wider">
                            <tr>
                                <th class="p-4">ID</th>
                                <th class="p-4">Customer</th>
                                <th class="p-4">Hub</th>
                                <th class="p-4">Value</th>
                                <th class="p-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dispatch-table" class="text-sm divide-y divide-slate-100">
                            </tbody>
                    </table>
                    <div id="empty-state" class="flex flex-col items-center justify-center p-20 text-slate-400 opacity-60">
                        <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" /></svg>
                        <p>No parcels dispatched yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let dispatchHistory =;
        let totalValue = 0;
        let hubXCount = 0;

        function processDispatch() {
            const cust = document.getElementById('cust').value |

| "Unnamed Customer";
            const addr = document.getElementById('addr').value |

| "No Address Provided";
            const hub = document.getElementById('hub').value;
            const price = parseFloat(document.getElementById('price').value) |

| 0.00;
            const weight = document.getElementById('weight').value |

| "1.0";
            const pay = document.getElementById('pay').value;
            
            const parcelId = "ID-" + Math.floor(100000 + Math.random() * 900000);

            const parcelData = {
                id: parcelId,
                cust: cust,
                addr: addr,
                hub: hub,
                val: price.toFixed(2),
                wt: weight,
                pay: pay,
                timestamp: new Date().toLocaleTimeString()
            };

            // 1. Generate QR Code
            const qrString = JSON.stringify(parcelData);
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrString)}&margin=10`;
            document.getElementById('qr-container').innerHTML = `<img src="${qrUrl}" id="qr-img" class="w-48 h-48">`;
            document.getElementById('display-id').innerText = parcelId;
            document.getElementById('qr-result').classList.remove('hidden');

            // 2. Update Log and Stats
            dispatchHistory.unshift(parcelData);
            totalValue += price;
            if(hub === 'Zone X') hubXCount++;
            
            updateDashboard();
        }

        function updateDashboard() {
            const tbody = document.getElementById('dispatch-table');
            const empty = document.getElementById('empty-state');
            
            empty.style.display = dispatchHistory.length > 0? 'none' : 'flex';
            
            tbody.innerHTML = dispatchHistory.map((p, index) => `
                <tr class="hover:bg-slate-50 transition-colors animate-in fade-in slide-in-from-top-4">
                    <td class="p-4 font-mono font-bold text-blue-600">${p.id}</td>
                    <td class="p-4 font-semibold">${p.cust}</td>
                    <td class="p-4"><span class="px-2 py-1 ${p.hub === 'Zone X'? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-700'} rounded-lg text-[10px] font-bold uppercase">${p.hub}</span></td>
                    <td class="p-4 font-bold text-slate-700">$${p.val}</td>
                    <td class="p-4">
                        <button onclick="downloadInvoice(${index})" class="bg-slate-900 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1 hover:bg-black transition-all">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                            Invoice
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('stat-total').innerText = dispatchHistory.length;
            document.getElementById('stat-hub-x').innerText = hubXCount;
            document.getElementById('stat-value').innerText = `$${totalValue.toFixed(2)}`;
        }

        function downloadQR() {
            const img = document.getElementById('qr-img');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = `Label-${document.getElementById('display-id').innerText}.png`;
            link.click();
        }

        function downloadInvoice(index) {
            const data = dispatchHistory[index];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Invoice Styling & Content
            doc.setFillColor(30, 41, 59); // Slate-900
            doc.rect(0, 0, 210, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("SMARTLOGISTICS PRO", 15, 20);
            doc.setFontSize(10);
            doc.text("Automated Fulfillment Hub | Unit 01", 15, 30);

            doc.setTextColor(30, 41, 59);
            doc.setFontSize(16);
            doc.text("SHIPPING INVOICE", 15, 60);
            
            doc.setFontSize(10);
            doc.text(`Invoice ID: ${data.id}`, 15, 70);
            doc.text(`Dispatch Date: ${new Date().toLocaleDateString()}`, 15, 75);

            doc.setFont("helvetica", "bold");
            doc.text("BILL TO:", 15, 95);
            doc.setFont("helvetica", "normal");
            doc.text(data.cust, 15, 100);
            doc.text(data.addr, 15, 105);

            // Item Table
            doc.autoTable({
                startY: 120,
                head:],
                body:`, data.hub, `${data.wt} kg`, `$${data.val}`],
                theme: 'striped',
                headStyles: { fillColor:  }
            });

            const finalY = doc.lastAutoTable.finalY;
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text(`TOTAL AMOUNT: $${data.val}`, 140, finalY + 20);

            doc.setFontSize(10);
            doc.setFont("helvetica", "italic");
            doc.text("Thank you for choosing our automated sorting service.", 105, 280, { align: "center" });

            doc.save(`Invoice_${data.id}.pdf`);
        }
    </script>
</body>
</html>
